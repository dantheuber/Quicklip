<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>QuicKlip2 - Preferences</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <style media="screen">
      body{
        background-color: black;
        color: white;
        -webkit-app-region: drag;
        height:100%;
      }
      input{
        -webkit-app-region: no-drag;
      }
      button {
        -webkit-app-region: no-drag;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="col-md-6">
          <br>
          <div class="jumbotron text-center">
            <h1 style="color: black">Preferences</h1>
          </div>
          <form class="form-horizontal" action="#">
            <div class="form-group">
              <label for="clipcount" class="col-sm-4">Number of clips to save:</label>
              <div class="col-sm-8">
                <input class="form-control" type="number" name="clipcount" id="clipcount">
              </div>
            </div>
            <div class="form-group">
              <label class="col-sm-4" for="textarea-fontsize">Textarea Font Size (px):</label>
              <div class="col-sm-8">
                <input class="form-control" type="number" name="textarea-fontsize" id="textarea-fontsize">
              </div>
            </div>
            <div class="form-group">
              <label class="col-sm-4" for="textarea-height">Textarea Height (px):</label>
              <div class="col-sm-8">
                <input class="form-control" type="number" name="textarea-height" id="textarea-height">
              </div>
            </div>
            <div class="form-group">
              <div class="col-sm-offset-4 col-sm-8">
                <button class="btn btn-primary" id="save" type="button" name="button">Save</button>
                <button class="btn btn-danger" id="cancel" type="button" name="button">Cancel</button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script type="text/javascript">
      $(window).on('message',function(event){
        console.log(event.data);
      });
      $('form').on('submit',function(e){
        e.preventDefault();
        e.stopPropagation();
      }).on('keypress',function(e){
        if(e.keyCode == 13){
          $('#save').click();
        }
      });
      $('#cancel').click(function(e){
        e.preventDefault();
        e.stopPropagation();
        window.close();
      });
      $('#save').click(function(e){
        e.preventDefault();
        e.stopPropagation();
        var preferences = {};
        preferences.window = global.preferences.window;
        preferences.max_clips = $('#clipcount').val();
        preferences.textarea = {
          height: $('#textarea-height').val(),
          fontsize: $('#textarea-fontsize').val()
        };

        require('fs').writeFile(global.root+'/preferences.json', JSON.stringify(preferences), function(err){
          if(err)console.error(err);
          window.opener.postMessage({ type:'prefs', value:preferences },'*');
          window.close();
        });
      });
      $('#clipcount').val(global.preferences.max_clips);
      $('#textarea-fontsize').val(global.preferences.textarea.fontsize);
      $('#textarea-height').val(global.preferences.textarea.height);
    </script>
  </body>
</html>
