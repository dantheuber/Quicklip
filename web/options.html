<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>QuicKlip2 - Preferences</title>
    <link rel="stylesheet" href="./bootstrap.css">
    <style media="screen">
      body{
        background-color: black;
        color: white;
        -webkit-app-region: drag;
        height:100%;
      }
      input{
        -webkit-app-region: no-drag;
      }
      button {
        -webkit-app-region: no-drag;
      }
      .clip {
        box-sizing: border-box;
        background-color: rgba(92, 92, 92, 0.6);
        color: white;
        width: 89%;
        resize: vertical;
        height: 27px;
        word-break: break-all;
        overflow: hidden;
        -webkit-app-region: no-drag;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <br>
          <div class="jumbotron text-center">
            <h1 style="color: black">Preferences</h1>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-xs-6">
          <form class="form-horizontal" action="#">
            <div class="form-group">
              <label for="clipcount" class="col-sm-4">Number of clips to save:</label>
              <div class="col-sm-8">
                <input class="form-control" type="number" name="clipcount" id="clipcount">
              </div>
            </div>
            <div class="form-group">
              <label class="col-sm-4" for="textarea-fontsize">Textarea Font Size (px):</label>
              <div class="col-sm-8">
                <input class="form-control" type="number" name="textarea-fontsize" id="textarea-fontsize">
              </div>
            </div>
            <div class="form-group">
              <label class="col-sm-4" for="textarea-height">Textarea Height (px):</label>
              <div class="col-sm-8">
                <input class="form-control" type="number" name="textarea-height" id="textarea-height">
              </div>
            </div>
            <div class="form-group">
              <div class="col-sm-offset-4 col-sm-8">
                <button class="btn btn-primary" id="save" type="button" name="button">Save</button>
                <button class="btn btn-danger" id="cancel" type="button" name="button">Cancel</button>
              </div>
            </div>
          </form>
        </div>
        <div class="col-xs-6">
          <label for="example">Text Box Preview:</label>
          <textarea name="example" class="clip">Bacon ipsum dolor amet doner andouille alcatra venison meatloaf. Jowl ball tip chicken pork belly spare ribs beef ham. Ball tip rump swine leberkas, pork belly doner pork chop bresaola shanke.</textarea>
        </div>
      </div>
    </div>
    <script src="./jquery.js"></script>
    <script type="text/javascript">
      applyPreferences();
      $('.clip').focusin(function(){
        if(this.clientHeight < this.scrollHeight){
          this.style.height = this.scrollHeight + 'px';
          if(this.clientHeight < this.scrollHeight){
            this.style.height = (this.scrollHeight * 2) - this.clientHeight + 'px';
          }
        }
      }).focusout(function(){
        this.style.height = global.preferences.textarea.height+'px';
      });

      $('#textarea-fontsize').on('keyup',function(e){
        $('.clip').css('font-size',this.value + 'px');
      });
      $('#textarea-height').on('keyup',function(e){
        $('.clip').css('height',this.value + 'px');
      })
      $('form').on('submit',function(e){
        e.preventDefault();
        e.stopPropagation();
      }).on('keypress',function(e){
        if(e.keyCode == 13){
          $('#save').click();
        }
      });
      $('#cancel').click(function(e){
        e.preventDefault();
        e.stopPropagation();
        window.close();
      });
      $('#save').click(function(e){
        e.preventDefault();
        e.stopPropagation();
        var preferences = {};
        preferences.window = global.preferences.window;
        preferences.max_clips = $('#clipcount').val();
        preferences.textarea = {
          height: $('#textarea-height').val(),
          fontsize: $('#textarea-fontsize').val()
        };

        require('fs').writeFile(global.root+'/preferences.json', JSON.stringify(preferences), function(err){
          if(err)console.error(err);
          window.opener.postMessage({ type:'prefs', value:preferences },'*');
          window.close();
        });
      });
      $('#clipcount').val(global.preferences.max_clips);
      $('#textarea-fontsize').val(global.preferences.textarea.fontsize);
      $('#textarea-height').val(global.preferences.textarea.height);

      function applyPreferences(){
        $('.clip').each(function(){
          $(this).css({
            'height': global.preferences.textarea.height,
            'font-size': global.preferences.textarea.fontsize + 'px'
          });
        });
      }
    </script>
  </body>
</html>
